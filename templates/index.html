<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Simple ChatGPT Interface</title>
	<style>
		:root {
			--bg: #0f1226;
			--card: #171a36;
			--muted: #9aa4ff;
			--accent: #7b5cff;
			--accent-2: #ff7bd7;
			--accent-3: #4ce0b3;
			--text: #e8e9ff;
			--text-muted: #b7baf7;
		}

		@media (prefers-color-scheme: light) {
			:root {
				--bg: #f7f7ff;
				--card: #ffffff;
				--muted: #5560ff;
				--accent: #6c4dff;
				--accent-2: #ff4fbf;
				--accent-3: #00c79b;
				--text: #1d1d35;
				--text-muted: #4a4f84;
			}
		}

		* { box-sizing: border-box; }
		body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; background: var(--bg); color: var(--text); }
		.container { max-width: 1000px; margin: 0 auto; padding: 1rem; }

		.header {
			background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 50%, var(--accent-3) 100%);
			padding: 2.25rem 1rem; color: white; text-align: center;
		}
		.header h1 { margin: 0; font-weight: 800; letter-spacing: 0.5px; text-shadow: 0 10px 30px rgba(0,0,0,0.25); }
		.header .actions { margin-top: 1rem; display: flex; justify-content: center; gap: 0.75rem; flex-wrap: wrap; }
		.btn { appearance: none; border: 0; border-radius: 12px; padding: 0.7rem 1rem; font-weight: 600; cursor: pointer; transition: transform 0.08s ease, box-shadow 0.2s ease, background 0.2s ease; }
		.btn.primary { background: #ffffff; color: #2e2e5a; box-shadow: 0 10px 20px rgba(0,0,0,0.15); }
		.btn.secondary { background: rgba(255,255,255,0.18); color: #ffffff; border: 1px solid rgba(255,255,255,0.35); backdrop-filter: blur(6px); }
		.btn:hover { transform: translateY(-1px); box-shadow: 0 14px 28px rgba(0,0,0,0.18); }
		.btn:active { transform: translateY(0); }

		.grid { display: grid; gap: 1rem; grid-template-columns: 1fr; padding: 1rem; }
		@media (min-width: 900px) { .grid { grid-template-columns: 2fr 1fr; } }

		.card { background: var(--card); border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); overflow: hidden; }
		.card .section-title { margin: 0; padding: 0.9rem 1rem; font-size: 0.9rem; letter-spacing: 0.08em; text-transform: uppercase; color: var(--text-muted); border-bottom: 1px solid rgba(255,255,255,0.06); }

		.chat-window { height: 55vh; max-height: 640px; overflow-y: auto; padding: 1rem; }
		.msg { padding: 0.75rem 1rem; margin: 0.5rem 0; border-radius: 14px; white-space: pre-wrap; width: fit-content; max-width: 100%; box-shadow: 0 4px 14px rgba(0,0,0,0.15); }
		.msg.user { background: linear-gradient(135deg, rgba(123,92,255,0.3), rgba(255,123,215,0.3)); border: 1px solid rgba(123,92,255,0.35); }
		.msg.assistant { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); }
		.msg strong { color: var(--muted); }

		.form { padding: 1rem; display: grid; gap: 0.75rem; }
		label { font-weight: 700; color: var(--text-muted); }
		textarea { width: 100%; height: 140px; padding: 0.9rem 1rem; font-size: 1rem; border-radius: 14px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.04); color: var(--text); outline: none; box-shadow: inset 0 1px 0 rgba(255,255,255,0.06); }
		textarea:focus { border-color: var(--accent-3); box-shadow: 0 0 0 3px rgba(76,224,179,0.25); }
		.actions-row { display: flex; gap: 0.6rem; align-items: center; justify-content: flex-end; }

		.notice { margin-top: 1rem; padding: 0.9rem 1rem; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.06); border-left: 4px solid var(--accent-2); color: var(--text-muted); border-radius: 8px; }
		.error { margin-top: 1rem; padding: 0.9rem 1rem; background: rgba(255,0,64,0.08); border: 1px solid rgba(255,0,64,0.2); color: #ff8aa0; border-radius: 8px; }
	</style>
</head>
<body>
	<header class="header">
		<div class="container">
			<h1>Tom's Expert Agent</h1>
			<div class="actions">
				<form method="POST" action="/clear">
					<button class="btn secondary" type="submit">Clear conversation</button>
				</form>
			</div>
		</div>
	</header>

	<main class="container">
		<div class="grid">
			<section class="card">
				<h3 class="section-title">Conversation</h3>
				<div class="chat-window" id="chat-window">
					{% if history %}
						{% for m in history %}
							<div class="msg {{ m.role }}">
								<strong>{{ m.role|capitalize }}:</strong> {{ m.content }}
							</div>
						{% endfor %}
					{% else %}
						<div class="notice">No messages yet. Start the conversation below!</div>
					{% endif %}
				</div>
			</section>

			<section class="card">
				<h3 class="section-title">Send a message</h3>
				<form class="form" method="POST" action="/chat">
					<label for="prompt">Your message</label>
					<textarea id="prompt" name="prompt" placeholder="Type your message here...">{{ user_text }}</textarea>
					<div class="actions-row">
						<button class="btn primary" type="submit">Send</button>
					</div>
				</form>

				{% if error_text %}
					<div class="error">{{ error_text }}</div>
				{% endif %}
			</section>
		</div>
	</main>

	<script>
		(function() {
			var el = document.getElementById('chat-window');
			if (el) { el.scrollTop = el.scrollHeight; }
		})();
	</script>
</body>
</html>
